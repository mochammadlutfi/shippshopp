import{a9 as ge,at as j,aV as be,c8 as he,aj as me,ab as P,au as ye,R as Q,aR as Ee,ag as $e,T as we,r as d,ak as Se,f as w,cz as Ae,an as Te,j as S,k as Ie,l as f,p as G,H as A,U as a,W as X,v as T,bX as ke,s as D,G as h,aF as Ce,c0 as Ne,F as Fe,u as Ve,$ as Be,q as Pe,aT as De,bt as E,a2 as J,bH as _e,bV as Oe,V as Re,b4 as _,b8 as Ke,X as Le}from"./id.js";import{a as We,E as Me}from"./index21.js";import{U as I,I as O,C as Y}from"./event.js";import{d as Ue}from"./debounce.js";const He=ge({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:j(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:j([Function,Array]),default:be},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:he.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...me(["ariaLabel"])}),qe={[I]:l=>P(l),[O]:l=>P(l),[Y]:l=>P(l),focus:l=>l instanceof FocusEvent,blur:l=>l instanceof FocusEvent,clear:()=>!0,select:l=>ye(l)},ze=["aria-expanded","aria-owns"],je={key:0},Ge=["id","aria-selected","onClick"],Z="ElAutocomplete",Xe=Q({name:Z,inheritAttrs:!1}),Je=Q({...Xe,props:He,emits:qe,setup(l,{expose:x,emit:u}){const o=l,ee=We(),ae=Ee(),R=$e(),c=we("autocomplete"),n=d(),K=d(),k=d(),L=d();let W=!1,C=!1;const i=d([]),s=d(-1),M=d(""),p=d(!1),$=d(!1),g=d(!1),m=Se(),te=w(()=>ae.style),v=w(()=>(i.value.length>0||g.value)&&p.value),U=w(()=>!o.hideLoading&&g.value),se=w(()=>n.value?Array.from(n.value.$el.querySelectorAll("input")):[]),le=()=>{v.value&&(M.value=`${n.value.$el.offsetWidth}px`)},oe=()=>{s.value=-1},H=Ue(async e=>{if($.value)return;const t=r=>{g.value=!1,!$.value&&(_(r)?(i.value=r,s.value=o.highlightFirstItem?0:-1):Ke(Z,"autocomplete suggestions must be an array"))};if(g.value=!0,_(o.fetchSuggestions))t(o.fetchSuggestions);else{const r=await o.fetchSuggestions(e,t);_(r)&&t(r)}},o.debounce),ne=e=>{const t=!!e;if(u(O,e),u(I,e),$.value=!1,p.value||(p.value=t),!o.triggerOnFocus&&!e){$.value=!0,i.value=[];return}H(e)},re=e=>{var t;R.value||(((t=e.target)==null?void 0:t.tagName)!=="INPUT"||se.value.includes(document.activeElement))&&(p.value=!0)},ue=e=>{u(Y,e)},ie=e=>{C?C=!1:(p.value=!0,u("focus",e),o.triggerOnFocus&&!W&&H(String(o.modelValue)))},ce=e=>{setTimeout(()=>{var t;if((t=k.value)!=null&&t.isFocusInsideContent()){C=!0;return}p.value&&y(),u("blur",e)})},de=()=>{p.value=!1,u(I,""),u("clear")},q=async()=>{v.value&&s.value>=0&&s.value<i.value.length?N(i.value[s.value]):o.selectWhenUnmatched&&(u("select",{value:o.modelValue}),i.value=[],s.value=-1)},pe=e=>{v.value&&(e.preventDefault(),e.stopPropagation(),y())},y=()=>{p.value=!1},fe=()=>{var e;(e=n.value)==null||e.focus()},ve=()=>{var e;(e=n.value)==null||e.blur()},N=async e=>{u(O,e[o.valueKey]),u(I,e[o.valueKey]),u("select",e),i.value=[],s.value=-1},F=e=>{if(!v.value||g.value)return;if(e<0){s.value=-1;return}e>=i.value.length&&(e=i.value.length-1);const t=K.value.querySelector(`.${c.be("suggestion","wrap")}`),b=t.querySelectorAll(`.${c.be("suggestion","list")} li`)[e],V=t.scrollTop,{offsetTop:z,scrollHeight:B}=b;z+B>V+t.clientHeight&&(t.scrollTop+=B),z<V&&(t.scrollTop-=B),s.value=e,n.value.ref.setAttribute("aria-activedescendant",`${m.value}-item-${s.value}`)};return Ae(L,()=>{v.value&&y()}),Te(()=>{n.value.ref.setAttribute("role","textbox"),n.value.ref.setAttribute("aria-autocomplete","list"),n.value.ref.setAttribute("aria-controls","id"),n.value.ref.setAttribute("aria-activedescendant",`${m.value}-item-${s.value}`),W=n.value.ref.hasAttribute("readonly")}),x({highlightedIndex:s,activated:p,loading:g,inputRef:n,popperRef:k,suggestions:i,handleSelect:N,handleKeyEnter:q,focus:fe,blur:ve,close:y,highlight:F}),(e,t)=>(S(),Ie(a(Oe),{ref_key:"popperRef",ref:k,visible:a(v),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[a(c).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${a(c).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:le,onHide:oe},{content:f(()=>[G("div",{ref_key:"regionRef",ref:K,class:A([a(c).b("suggestion"),a(c).is("loading",a(U))]),style:X({[e.fitInputWidth?"width":"minWidth"]:M.value,outline:"none"}),role:"region"},[T(a(ke),{id:a(m),tag:"ul","wrap-class":a(c).be("suggestion","wrap"),"view-class":a(c).be("suggestion","list"),role:"listbox"},{default:f(()=>[a(U)?(S(),D("li",je,[h(e.$slots,"loading",{},()=>[T(a(Ce),{class:A(a(c).is("loading"))},{default:f(()=>[T(a(Ne))]),_:1},8,["class"])])])):(S(!0),D(Fe,{key:1},Ve(i.value,(r,b)=>(S(),D("li",{id:`${a(m)}-item-${b}`,key:b,class:A({highlighted:s.value===b}),role:"option","aria-selected":s.value===b,onClick:V=>N(r)},[h(e.$slots,"default",{item:r},()=>[Be(Pe(r[e.valueKey]),1)])],10,Ge))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:f(()=>[G("div",{ref_key:"listboxRef",ref:L,class:A([a(c).b(),e.$attrs.class]),style:X(a(te)),role:"combobox","aria-haspopup":"listbox","aria-expanded":a(v),"aria-owns":a(m)},[T(a(Me),De({ref_key:"inputRef",ref:n},a(ee),{clearable:e.clearable,disabled:a(R),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:ne,onChange:ue,onFocus:ie,onBlur:ce,onClear:de,onKeydown:[t[0]||(t[0]=E(J(r=>F(s.value-1),["prevent"]),["up"])),t[1]||(t[1]=E(J(r=>F(s.value+1),["prevent"]),["down"])),E(q,["enter"]),E(y,["tab"]),E(pe,["esc"])],onMousedown:re}),_e({_:2},[e.$slots.prepend?{name:"prepend",fn:f(()=>[h(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:f(()=>[h(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:f(()=>[h(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:f(()=>[h(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,ze)]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var Qe=Re(Je,[["__file","autocomplete.vue"]]);const ta=Le(Qe);export{ta as E};
