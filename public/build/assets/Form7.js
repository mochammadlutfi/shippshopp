import P from"./CustomerSelect.js";import{_ as x,A as g,j as _,k as S,l as s,p as i,v as o,q as r,$ as n,s as y,F as v,a0 as w,a2 as D,E as M}from"./id.js";import{E as U}from"./index20.js";import{E as Y,a as B}from"./index22.js";import{E as F,a as N}from"./index8.js";import{E as O}from"./index35.js";import{E as L}from"./index36.js";import{E as A,a as I}from"./index31.js";import{E as z}from"./index24.js";import"./index32.js";import"./index21.js";import"./typescript.js";import"./event.js";import"./index30.js";import"./isEqual.js";import"./_Uint8Array.js";import"./scroll.js";import"./debounce.js";import"./index33.js";import"./index7.js";import"./_initCloneObject.js";import"./index25.js";import"./index23.js";const H={components:{CustomerSelect:P},props:{data:{type:Object,default:{}},errors:Object},data(){return{title:"Tambah Penjualan",query:"",loading:!1,form:{id:null,nomor:null,customer_id:null,date:null,total:0},lines:[],lines_deleted:[]}},created(){Object.keys(this.data).length&&this.setValue()},methods:{selectProduct(e){if(this.lines.length>=1)if(this.lines.some(d=>d.variant_id===e.id))for(var t=0;t<this.lines.length;t++)this.lines[t].variant_id===e.id&&this.lines[t].qty++;else this.lines.push({id:null,variant_id:e.id,product_id:e.product_id,variant:e.name,product:e.product,qty:1,price:e.sell_price,unit_id:e.sell_unit_id});else this.lines.push({id:null,variant_id:e.id,product_id:e.product_id,variant:e.name,product:e.product,qty:1,price:e.sell_price,unit_id:e.sell_unit_id});this.calculateTotal(),this.$forceUpdate()},async findProduct(e){try{this.isLoading=!0;const t=await axios.get("/admin/produk/search",{params:{q:e}});if(t.status==200)return t.data;this.isLoading=!1}catch(t){console.error(t)}},removeLine(e,t){t&&this.lines_deleted.push(t),this.lines.splice(e,1),this.calculateTotal(),this.$forceUpdate()},submit(){this.loading=!0;let e=Object.assign(this.form,{lines:this.lines,lines_deleted:this.lines_deleted}),t=this.$inertia.form(e),d=Object.keys(this.data).length?this.route("admin.sale.order.update",{id:this.data.id}):this.route("admin.sale.order.store");t.post(d,{preserveScroll:!0,onSuccess:()=>{U({type:"success",message:"Data Berhasil Disimpan!"})},onFinish:()=>{this.loading=!1}})},setValue(){this.title="Ubah Penjualan",this.form.id=this.data.id,this.form.nomor=this.data.nomor,this.form.customer_id=this.data.customer_id,this.form.date=this.data.date,this.form.total=this.data.total,this.data.lines.forEach((e,t)=>{this.lines.push({id:e.id,product:e.product.name,variant:e.variant.name,variant_id:e.variant_id,product_id:e.product_id,price:e.price,qty:e.qty,unit_id:e.unit_id,subtotal:e.subtotal})})},calculateTotal(){let e=0;for(var t=0;t<this.lines.length;t++)this.lines[t].subtotal=this.lines[t].qty*this.lines[t].price,e+=this.lines[t].subtotal;this.form.total=e}}},Q={class:"content"},R={class:"content-heading d-flex justify-content-between align-items-center pt-0"},G={class:"space-x-1"},J=i("i",{class:"fa fa-check me-2"},null,-1),K={class:"block block-rounded"},W={class:"block-content p-4"},X=i("span",null,[i("i",{class:"fa fa-search"})],-1),Z=i("i",{class:"fa fa-times"},null,-1),$={class:"d-flex float-end justify-content-end w-75 fs-4"},ee=i("div",{class:""},"Total",-1),te={class:"text-end w-50"};function le(e,t,d,oe,a,c){const p=M,k=g("customer-select"),f=Y,m=F,E=O,h=N,V=L,u=A,q=z,T=I,j=B,C=g("base-layout");return _(),S(C,{title:a.title},{default:s(()=>[i("div",Q,[o(j,{"label-width":"30%",onSubmit:D(c.submit,["prevent"]),"label-position":"top"},{default:s(()=>[i("div",R,[i("span",null,r(a.title),1),i("div",G,[o(p,{"native-type":"submit",type:"primary",loading:a.loading},{default:s(()=>[J,n(" Simpan ")]),_:1},8,["loading"])])]),i("div",K,[i("div",W,[o(h,{gutter:32},{default:s(()=>[o(m,{lg:12},{default:s(()=>[o(f,{class:"mb-4",label:"Pelanggan",error:d.errors.name},{default:s(()=>[o(k,{modelValue:a.form.customer_id,"onUpdate:modelValue":t[0]||(t[0]=l=>a.form.customer_id=l)},null,8,["modelValue"])]),_:1},8,["error"])]),_:1}),o(m,{lg:12},{default:s(()=>[o(f,{class:"mb-4",label:"Tanggal",error:d.errors.email},{default:s(()=>[o(E,{modelValue:a.form.date,"onUpdate:modelValue":t[1]||(t[1]=l=>a.form.date=l),type:"date",class:"w-100",placeholder:"Pilih Tanggal",format:"DD MMMM YYYY","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},8,["error"])]),_:1})]),_:1}),o(V,{modelValue:a.query,"onUpdate:modelValue":t[2]||(t[2]=l=>a.query=l),"fetch-suggestions":c.findProduct,clearable:"","trigger-on-focus":!1,class:"inline-input w-50 mb-3",placeholder:"Cari Produk",onSelect:c.selectProduct},{default:s(({item:l})=>[i("div",null,[n(r(l.product)+" ",1),l.product?(_(),y(v,{key:0},[n(" - "+r(l.name),1)],64)):w("",!0)]),i("div",null,r(l.sku),1)]),prefix:s(()=>[X]),_:1},8,["modelValue","fetch-suggestions","onSelect"]),o(T,{data:a.lines,border:"",class:"mb-4",id:"variant"},{default:s(()=>[o(u,{label:"Produk"},{default:s(l=>[i("div",null,[n(r(l.row.product)+" ",1),l.row.product?(_(),y(v,{key:0},[n(" - "+r(l.row.variant),1)],64)):w("",!0)]),i("div",null,r(l.row.sku),1)]),_:1}),o(u,{label:"Harga"},{default:s(l=>[n(r(e.currency(l.row.price)),1)]),_:1}),o(u,{label:"Qty"},{default:s(l=>[o(q,{modelValue:l.row.qty,"onUpdate:modelValue":b=>l.row.qty=b,min:1,onChange:c.calculateTotal},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(u,{label:"Total"},{default:s(l=>[n(r(e.currency(l.row.price*l.row.qty)),1)]),_:1}),o(u,{width:"60px",align:"center"},{default:s(l=>[o(p,{type:"danger",size:"small",onClick:b=>c.removeLine(l.$index,l.row.id)},{default:s(()=>[Z]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),o(h,{justify:"end"},{default:s(()=>[o(m,{lg:12,class:"float-end"},{default:s(()=>[i("div",$,[ee,i("div",te,r(e.currency(a.form.total)),1)])]),_:1})]),_:1})])])]),_:1},8,["onSubmit"])])]),_:1},8,["title"])}const je=x(H,[["render",le]]);export{je as default};
