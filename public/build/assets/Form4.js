import q from"./SupplierSelect.js";import{h as P}from"./moment.js";import{_ as S,A as g,j as T,k as Y,l as i,p as l,v as s,q as d,$ as m,a2 as x,E as C}from"./id.js";import{E as M}from"./index20.js";import{E as j,a as U}from"./index22.js";import{E as B,a as L}from"./index8.js";import{E as O}from"./index35.js";import{E as F}from"./index36.js";import{E as N,a as A}from"./index31.js";import{E as I}from"./index24.js";import"./index32.js";import"./index21.js";import"./typescript.js";import"./event.js";import"./index30.js";import"./isEqual.js";import"./_Uint8Array.js";import"./scroll.js";import"./debounce.js";import"./index33.js";import"./index7.js";import"./_initCloneObject.js";import"./index25.js";import"./index23.js";const z={components:{SupplierSelect:q},props:{data:{type:Object,default:{}},errors:Object},data(){return{title:"Tambah Pesanan Pembelian",query:"",loading:!1,form:{id:null,nomor:null,supplier_id:null,date:P().format("YYYY-MM-DD"),total:0},supplier:null,lines:[],lines_deleted:[]}},mounted(){Object.keys(this.data).length&&this.setValue()},methods:{disabledDate(t){var e=new Date;return e.setDate(e.getDate()-1),t<e},async getDetail(t){try{this.isLoading=!0;const e=await axios.get("/admin/supplier/produk",{params:{id:t}});if(e.status==200){const n=e.data;this.lines=[],this.form.sales=n.pic,n.lines.forEach((o,r)=>{this.lines.push({id:o.id,product:o.product.name,variant:o.variant.name,stock:o.variant.stock,variant_id:o.variant_id,product_id:o.product_id,unit:o.variant.purchase_unit.name,price:o.variant.purchase_price,qty:1,unit_id:o.variant.purchase_unit_id,subtotal:o.variant.purchase_price})})}this.isLoading=!1}catch(e){console.error(e)}},selectProduct(t){if(this.lines.length>=1){if(this.lines.some(n=>n.product_id===t.id))for(var e=0;e<this.lines.length;e++)this.lines[e].product_id===t.id&&this.lines[e].qty++}else this.lines.push({id:null,product_id:t.id,stock:t.stok,product:t.nama,sku:t.sku,qty:1,price:t.harga_beli});this.calculateTotal(),this.$forceUpdate()},async findProduct(t){try{this.isLoading=!0;const e=await axios.get("/admin/produk/search",{params:{q:t}});if(e.status==200)return e.data;this.isLoading=!1}catch(e){console.error(e)}},removeLine(t,e){e&&this.lines_deleted.push(e),this.lines.splice(t,1),this.calculateTotal(),this.$forceUpdate()},submit(){this.loading=!0;let t=Object.assign(this.form,{lines:this.lines,lines_deleted:this.lines_deleted}),e=this.$inertia.form(t),n=Object.keys(this.data).length?this.route("admin.purchase.order.update",{id:this.data.id}):this.route("admin.purchase.order.store");e.post(n,{preserveScroll:!0,onSuccess:()=>{M({type:"success",message:"Data Berhasil Disimpan!"})},onFinish:()=>{this.loading=!1}})},setValue(){this.title="Ubah Pesanan Pembelian",this.form.id=this.data.id,this.form.nomor=this.data.nomor,this.form.supplier_id=this.data.supplier_id,this.form.date=this.data.date,this.form.total=this.data.total,this.form.sales=this.data.supplier.pic,this.data.lines.forEach((t,e)=>{this.lines.push({id:t.id,product:t.product.name,variant:t.variant.name,variant_id:t.variant_id,product_id:t.product_id,price:t.price,qty:t.qty,unit:t.variant.purchase_unit.name,unit_id:t.purchase_unit_id,subtotal:t.subtotal})})},calculateTotal(){let t=0;for(var e=0;e<this.lines.length;e++)this.lines[e].subtotal=this.lines[e].qty*this.lines[e].price,t+=this.lines[e].subtotal;this.form.total=t}}},H={class:"content"},Q={class:"content-heading d-flex justify-content-between align-items-center pt-0"},R={class:"space-x-1"},G=l("i",{class:"fa fa-check me-2"},null,-1),J={class:"block block-rounded"},K={class:"block-content p-4"},W=l("span",null,[l("i",{class:"fa fa-search"})],-1),X=l("i",{class:"fa fa-times"},null,-1),Z={class:"d-flex float-end justify-content-end w-75 fs-4"},$=l("div",{class:""},"Total",-1),ee={class:"text-end w-50"};function te(t,e,n,o,r,u){const _=C,y=g("supplier-select"),h=j,p=B,k=O,f=L,w=F,c=N,v=I,E=A,V=U,D=g("base-layout");return T(),Y(D,null,{default:i(()=>[l("div",H,[s(V,{"label-width":"30%",onSubmit:x(u.submit,["prevent"]),"label-position":"top"},{default:i(()=>[l("div",Q,[l("span",null,d(r.title),1),l("div",R,[s(_,{"native-type":"submit",type:"primary",loading:r.loading},{default:i(()=>[G,m(" Simpan ")]),_:1},8,["loading"])])]),l("div",J,[l("div",K,[s(f,{gutter:32},{default:i(()=>[s(p,{lg:12},{default:i(()=>[s(h,{class:"mb-4",label:"Supplier",error:n.errors.name},{default:i(()=>[s(y,{modelValue:r.form.supplier_id,"onUpdate:modelValue":e[0]||(e[0]=a=>r.form.supplier_id=a),onChange:u.getDetail},null,8,["modelValue","onChange"])]),_:1},8,["error"])]),_:1}),s(p,{lg:12},{default:i(()=>[s(h,{class:"mb-4",label:"Tanggal",error:n.errors.email},{default:i(()=>[s(k,{modelValue:r.form.date,"onUpdate:modelValue":e[1]||(e[1]=a=>r.form.date=a),type:"date",class:"w-100",placeholder:"Pilih Tanggal",format:"DD MMMM YYYY","value-format":"YYYY-MM-DD","disabled-date":u.disabledDate},null,8,["modelValue","disabled-date"])]),_:1},8,["error"])]),_:1})]),_:1}),s(w,{modelValue:r.query,"onUpdate:modelValue":e[2]||(e[2]=a=>r.query=a),"fetch-suggestions":u.findProduct,clearable:"","trigger-on-focus":!1,class:"inline-input w-50 mb-3",placeholder:"Cari Produk",onSelect:u.selectProduct},{default:i(({item:a})=>[l("div",null,d(a.nama),1),l("div",null,d(a.sku),1)]),prefix:i(()=>[W]),_:1},8,["modelValue","fetch-suggestions","onSelect"]),s(E,{data:r.lines,border:"",class:"mb-4",id:"variant"},{default:i(()=>[s(c,{label:"Produk"},{default:i(a=>[l("div",null,d(a.row.product),1),l("div",null,d(a.row.sku),1)]),_:1}),s(c,{prop:"stock",label:"Stok"}),s(c,{label:"Harga Beli",width:"100"},{default:i(a=>[m(d(t.currency(a.row.price)),1)]),_:1}),s(c,{label:"Qty"},{default:i(a=>[s(v,{modelValue:a.row.qty,"onUpdate:modelValue":b=>a.row.qty=b,min:1,onChange:u.calculateTotal},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(c,{label:"Total"},{default:i(a=>[m(d(t.currency(a.row.price*a.row.qty)),1)]),_:1}),s(c,{width:"60px",align:"center"},{default:i(a=>[s(_,{type:"danger",size:"small",onClick:b=>u.removeLine(a.$index,a.row.id)},{default:i(()=>[X]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),s(f,{justify:"end"},{default:i(()=>[s(p,{lg:12,class:"float-end"},{default:i(()=>[l("div",Z,[$,l("div",ee,d(t.currency(r.form.total)),1)])]),_:1})]),_:1})])])]),_:1},8,["onSubmit"])])]),_:1})}const qe=S(z,[["render",te]]);export{qe as default};
