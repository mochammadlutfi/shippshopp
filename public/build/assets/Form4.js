import q from"./SupplierSelect.js";import{h as P}from"./moment.js";import{_ as S,A as g,j as T,k as Y,l,p as o,v as i,q as d,$ as m,a2 as x,E as C}from"./id.js";import{E as M}from"./index20.js";import{E as j,a as U}from"./index22.js";import{E as B,a as L}from"./index8.js";import{E as O}from"./index35.js";import{E as F}from"./index36.js";import{E as N,a as A}from"./index30.js";import{E as I}from"./index24.js";import"./index33.js";import"./index21.js";import"./typescript.js";import"./event.js";import"./index32.js";import"./isEqual.js";import"./_Uint8Array.js";import"./scroll.js";import"./debounce.js";import"./index31.js";import"./index7.js";import"./_initCloneObject.js";import"./index25.js";import"./index23.js";const z={components:{SupplierSelect:q},props:{data:{type:Object,default:{}},errors:Object},data(){return{title:"Tambah Pesanan Pembelian",query:"",loading:!1,form:{id:null,nomor:null,supplier_id:null,date:P().format("YYYY-MM-DD"),total:0},supplier:null,lines:[],lines_deleted:[]}},mounted(){Object.keys(this.data).length&&this.setValue()},methods:{disabledDate(e){var t=new Date;return t.setDate(t.getDate()-1),e<t},async getDetail(e){try{this.isLoading=!0;const t=await axios.get("/admin/supplier/produk",{params:{id:e}});if(t.status==200){const n=t.data;this.lines=[],this.form.sales=n.pic,n.lines.forEach((a,r)=>{this.lines.push({id:a.id,product:a.product.name,variant:a.variant.name,stock:a.variant.stock,variant_id:a.variant_id,product_id:a.product_id,unit:a.variant.purchase_unit.name,price:a.variant.purchase_price,qty:1,unit_id:a.variant.purchase_unit_id,subtotal:a.variant.purchase_price})})}this.isLoading=!1}catch(t){console.error(t)}},selectProduct(e){if(this.lines.length)if(this.lines.some(n=>n.product_id===e.id))for(var t=0;t<this.lines.length;t++)this.lines[t].product_id===e.id?this.lines[t].qty++:this.lines.push({id:null,product_id:e.id,stock:e.stok,product:e.nama,sku:e.sku,qty:1,price:e.harga_beli});else this.lines.push({id:null,product_id:e.id,stock:e.stok,product:e.nama,sku:e.sku,qty:1,price:e.harga_beli});else this.lines.push({id:null,product_id:e.id,stock:e.stok,product:e.nama,sku:e.sku,qty:1,price:e.harga_beli});this.calculateTotal(),this.$forceUpdate()},async findProduct(e){try{this.isLoading=!0;const t=await axios.get("/admin/produk/search",{params:{q:e}});if(t.status==200)return t.data;this.isLoading=!1}catch(t){console.error(t)}},removeLine(e,t){t&&this.lines_deleted.push(t),this.lines.splice(e,1),this.calculateTotal(),this.$forceUpdate()},submit(){this.loading=!0;let e=Object.assign(this.form,{lines:this.lines,lines_deleted:this.lines_deleted}),t=this.$inertia.form(e),n=Object.keys(this.data).length?this.route("admin.purchase.order.update",{id:this.data.id}):this.route("admin.purchase.order.store");t.post(n,{preserveScroll:!0,onSuccess:()=>{M({type:"success",message:"Data Berhasil Disimpan!"})},onFinish:()=>{this.loading=!1}})},setValue(){this.title="Ubah Pesanan Pembelian",this.form.id=this.data.id,this.form.nomor=this.data.nomor,this.form.supplier_id=this.data.supplier_id,this.form.date=this.data.date,this.form.total=this.data.total,this.form.sales=this.data.supplier.pic,this.data.lines.forEach((e,t)=>{this.lines.push({id:e.id,product:e.product.name,variant:e.variant.name,variant_id:e.variant_id,product_id:e.product_id,price:e.price,qty:e.qty,unit:e.variant.purchase_unit.name,unit_id:e.purchase_unit_id,subtotal:e.subtotal})})},calculateTotal(){let e=0;for(var t=0;t<this.lines.length;t++)this.lines[t].subtotal=this.lines[t].qty*this.lines[t].price,e+=this.lines[t].subtotal;this.form.total=e}}},H={class:"content"},Q={class:"content-heading d-flex justify-content-between align-items-center pt-0"},R={class:"space-x-1"},G=o("i",{class:"fa fa-check me-2"},null,-1),J={class:"block block-rounded"},K={class:"block-content p-4"},W=o("span",null,[o("i",{class:"fa fa-search"})],-1),X=o("i",{class:"fa fa-times"},null,-1),Z={class:"d-flex float-end justify-content-end w-75 fs-4"},$=o("div",{class:""},"Total",-1),ee={class:"text-end w-50"};function te(e,t,n,a,r,u){const _=C,y=g("supplier-select"),h=j,p=B,k=O,f=L,w=F,c=N,v=I,E=A,V=U,D=g("base-layout");return T(),Y(D,null,{default:l(()=>[o("div",H,[i(V,{"label-width":"30%",onSubmit:x(u.submit,["prevent"]),"label-position":"top"},{default:l(()=>[o("div",Q,[o("span",null,d(r.title),1),o("div",R,[i(_,{"native-type":"submit",type:"primary",loading:r.loading},{default:l(()=>[G,m(" Simpan ")]),_:1},8,["loading"])])]),o("div",J,[o("div",K,[i(f,{gutter:32},{default:l(()=>[i(p,{lg:12},{default:l(()=>[i(h,{class:"mb-4",label:"Supplier",error:n.errors.name},{default:l(()=>[i(y,{modelValue:r.form.supplier_id,"onUpdate:modelValue":t[0]||(t[0]=s=>r.form.supplier_id=s),onChange:u.getDetail},null,8,["modelValue","onChange"])]),_:1},8,["error"])]),_:1}),i(p,{lg:12},{default:l(()=>[i(h,{class:"mb-4",label:"Tanggal",error:n.errors.email},{default:l(()=>[i(k,{modelValue:r.form.date,"onUpdate:modelValue":t[1]||(t[1]=s=>r.form.date=s),type:"date",class:"w-100",placeholder:"Pilih Tanggal",format:"DD MMMM YYYY","value-format":"YYYY-MM-DD","disabled-date":u.disabledDate},null,8,["modelValue","disabled-date"])]),_:1},8,["error"])]),_:1})]),_:1}),i(w,{modelValue:r.query,"onUpdate:modelValue":t[2]||(t[2]=s=>r.query=s),"fetch-suggestions":u.findProduct,clearable:"","trigger-on-focus":!1,class:"inline-input w-50 mb-3",placeholder:"Cari Produk",onSelect:u.selectProduct},{default:l(({item:s})=>[o("div",null,d(s.nama),1),o("div",null,d(s.sku),1)]),prefix:l(()=>[W]),_:1},8,["modelValue","fetch-suggestions","onSelect"]),i(E,{data:r.lines,border:"",class:"mb-4",id:"variant"},{default:l(()=>[i(c,{label:"Produk"},{default:l(s=>[o("div",null,d(s.row.product),1),o("div",null,d(s.row.sku),1)]),_:1}),i(c,{prop:"stock",label:"Stok"}),i(c,{label:"Harga Beli",width:"100"},{default:l(s=>[m(d(e.currency(s.row.price)),1)]),_:1}),i(c,{label:"Qty"},{default:l(s=>[i(v,{modelValue:s.row.qty,"onUpdate:modelValue":b=>s.row.qty=b,min:1,onChange:u.calculateTotal},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),i(c,{label:"Total"},{default:l(s=>[m(d(e.currency(s.row.price*s.row.qty)),1)]),_:1}),i(c,{width:"60px",align:"center"},{default:l(s=>[i(_,{type:"danger",size:"small",onClick:b=>u.removeLine(s.$index,s.row.id)},{default:l(()=>[X]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),i(f,{justify:"end"},{default:l(()=>[i(p,{lg:12,class:"float-end"},{default:l(()=>[o("div",Z,[$,o("div",ee,d(e.currency(r.form.total)),1)])]),_:1})]),_:1})])])]),_:1},8,["onSubmit"])])]),_:1})}const qe=S(z,[["render",te]]);export{qe as default};
