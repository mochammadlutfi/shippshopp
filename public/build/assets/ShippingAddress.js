import{_ as S,r as E,w as j,a5 as M,j as u,s as p,p as a,k as x,l,a2 as b,a0 as V,q as d,v as r,E as F,$ as c,F as B,u as P}from"./id.js";import{E as v}from"./index20.js";import{E as N}from"./index26.js";import{E as T,a as U}from"./index8.js";import{E as D}from"./index21.js";import{E as O,a as R}from"./index22.js";import{E as z,a as H}from"./index28.js";import"./index7.js";import"./typescript.js";import"./index27.js";import"./scroll.js";import"./event.js";import"./_Uint8Array.js";import"./_initCloneObject.js";const I={name:"ShippingAddress",setup(){const e=E();return j(e,t=>{t&&t.$mapPromise.then(i=>{})}),{mapRef:e}},props:{modelValue:{type:Object,default:{}}},mounted(){this.center.lat=this.$page.props.location.lat,this.center.lng=this.$page.props.location.lng,this.marker.lat=this.$page.props.location.lat,this.marker.lng=this.$page.props.location.lng},data(){return{title:"Tambah Alamat Baru",selectMap:!0,form:{id:null,name:null,reciever:null,phone:null,address:null,formatted_address:null,lat:null,lng:null,is_main:0,distance:null},dataList:[],errors:{},terms:null,modalShow:!1,modalForm:!1,editMode:!1,selected:this.modelValue,locations:[],locationSelected:null,mapOptions:{mapTypeControl:!1,streetViewControl:!1,lang:"id"},center:{lat:51.093048,lng:6.84212},marker:{lat:51.093048,lng:6.84212}}},watch:{locationSelected(e){e?(this.form.lat=e.lat,this.form.lng=e.lng,this.form.postal_code=e.postal_code,this.form.area_id=e.area_id,this.form.area_text=e.area_text):(this.form.postal_code=null,this.form.lat=null,this.form.lng=null,this.form.area_id=null,this.form.area_text=null)},modelValue(e){Object.keys(e).length&&(this.selected=e)}},methods:{openModal(){this.modalShow=!0,this.fetchData()},selectAddress(e){this.selected=e,this.$emit("update:modelValue",e),this.modalShow=!1},async fetchData(){try{const e=await axios.get("/user/alamat/data",{params:{}});e.status==200&&(this.dataList=e.data),this.isLoading=!1}catch(e){console.error(e)}},createAddress(){this.modalForm=!0},closeForm(){this.reset(),this.$root.window.mobile||this.$bvModal.hide("modalCreateAddress")},reset(){this.title="Tambah Alamat Baru",this.form.id=null,this.form.name=null,this.form.reciever=null,this.form.phone=null,this.form.address=null,this.form.postal_code=null,this.form.area_id=null,this.form.area_text=null,this.form.lat=null,this.form.lng=null,this.modalForm=!1,this.modalShow=!1,this.errors={},this.locationSelected={},this.editMode=!1},onSearch(e,t){e.length&&(t(!0),this.search(t,e,this))},submit:function(){let e={};e=Object.assign(e,this.form);let t=this.editMode?this.route("user.address.update"):this.route("user.address.store");axios.post(t,e).then(i=>{i.data.fail?(this.errors=i.data.errors,this.$swal.close()):(this.$swal.close(),this.reset(),this.selected=i.data.data,this.$emit("done",i.data.data),this.$swal.fire({icon:"success",title:"Success",showConfirmButton:!1,showCancelButton:!1,html:"Alamat Baru Berhasil Ditambahkan!",timer:1500}))}).catch(function(i){i.response&&(this.errors=i.response.data.errors)})},search:M.debounce((e,t,i)=>{let m={keyword:t};axios.get(i.route("shipper.sub_urban"),{params:m}).then(function(s){const h=s.data;i.locations=[],h.data.forEach(n=>{i.locations.push({area_id:n.adm_level_5.id,area_text:n.adm_level_2.name+", "+n.adm_level_3.name+", "+n.adm_level_4.name+", "+n.adm_level_5.name,postal_code:n.postcodes[0],lat:n.adm_level_5.geo_coord.lat,lng:n.adm_level_5.geo_coord.lng})}),e(!1)}).catch(function(s){})},350),edit(e){this.reset(),this.title="Ubah Alamat",this.editMode=!0,this.form.id=e.id,this.form.name=e.name,this.form.reciever=e.reciever,this.form.phone=e.phone,this.form.address=e.address,this.form.postal_code=e.postal_code,this.form.area_id=e.area_id,this.form.area_text=e.area_text,this.form.lat=e.lat,this.form.lng=e.lng,this.locationSelected={area_id:e.area_id,area_text:e.area_text,postal_code:e.postal_code,lat:e.lat,lng:e.lng},this.$bvModal.hide("addressList"),this.$root.window.mobile?this.modalForm=!0:this.$bvModal.show("modalCreateAddress")},setLatLng(){this.form.lat=this.center.lat,this.form.lng=this.center.lng},removeLatLng(){this.form.lat=null,this.form.lng=null},async onDragend(e){try{this.isLoading=!0;const t=await axios.post("/user/alamat/geocode",{latlng:e.latLng.lat()+","+e.latLng.lng()});t.status==200&&(t.data.jarak<=1e4?(this.form.formatted_address=t.data.data,this.form.distance=t.data.jarak,this.center.lat=e.latLng.lat(),this.center.lng=e.latLng.lng(),this.form.lat=e.latLng.lat(),this.form.lng=e.latLng.lng()):(v({type:"error",message:"Lokasi Tidak Terjangkau!"}),this.center.lat=this.$page.props.location.lat,this.center.lng=this.$page.props.location.lng,this.marker.lat=this.$page.props.location.lat,this.marker.lng=this.$page.props.location.lng)),this.isLoading=!1}catch(t){console.error(t)}},setPlace(e){if(!e.geometry||!e.geometry.location){console.log("Returned place contains no geometry");return}this.center=e.geometry.location,this.form.lat=this.center.lat,this.form.lng=this.center.lng,this.form.formatted_address=e.formatted_address},async getStreetAddressFrom(e,t){const i=this;try{this.isLoading=!0;const m=await axios.post("/user/alamat/geocode",{latlng:e+","+t});m.status==200&&(m.data.jarak<=1e4?(i.form.distance=m.data.jarak,i.form.formatted_address=m.data.data):v({type:"error",message:"Lokasi Tidak Terjangkau!"})),this.isLoading=!1}catch(m){console.error(m)}},async submit(){const e=this;await axios.post("/user/alamat/json-store",e.form).then(t=>{const i=t.data;this.selected=i.result,this.$emit("update:modelValue",i.result),this.modalForm=!1}).catch(t=>{const i=t.response.data;e.errors=i.result,e.loading=!1,console.log(t)})}}},q={class:"content-heading d-flex justify-content-between mb-2 py-2"},G=a("span",null,"Alamat Pengiriman",-1),J={class:"space-x-1"},K={key:0,class:"block block-bordered rounded mb-2"},Y={class:"block-header border-3x border-bottom p-3"},Q={class:"block-title"},W={class:"block-content p-3"},X={class:"content__top-info"},Z={class:"top-info__name"},$={class:"top-info__phone"},ee={class:"content__complete-address"},te={class:"content__district"},se={key:1,class:"block block-bordered rounded mb-2"},oe={class:"block-content text-center p-3"},ae=a("h3",{class:"font-weight-bold h4"},"Alamat Pengiriman Belum Ditambahkan",-1),le=a("i",{class:"fa fa-plus me-2"},null,-1),re={class:"d-flex justify-content-between"},ie=["id"],ne={class:"block-content p-3"},de={class:"mb-3"},me={class:"font-size-md"},ce={class:"font-w700"},he={class:"content__complete-address"},ue={class:"content__district"},_e=a("i",{class:"si si-note me-1"},null,-1),pe=a("i",{class:"fa fa-check me-1"},null,-1),fe={class:"d-flex justify-content-between"},ge=["id"],be={class:"text-end"};function ke(e,t,i,m,s,h){const n=F,f=T,k=U,y=N,g=D,_=O,w=z,A=H,L=R;return u(),p("div",null,[a("div",q,[G,a("div",J,[Object.keys(s.selected).length?(u(),x(n,{key:0,type:"primary",plain:"",onClick:b(h.openModal,["prevent"])},{default:l(()=>[c(" Pilih Alamat Lain ")]),_:1},8,["onClick"])):V("",!0)])]),Object.keys(s.selected).length?(u(),p("div",K,[a("div",Y,[a("h3",Q,d(s.selected.name),1)]),a("div",W,[a("div",X,[a("span",Z,d(s.selected.reciever),1),a("span",$,d(s.selected.phone),1)]),a("div",ee,d(s.selected.address),1),a("div",te,d(s.selected.area_text),1)])])):(u(),p("div",se,[a("div",oe,[ae,r(n,{type:"primary",onClick:b(h.createAddress,["prevent"])},{default:l(()=>[le,c("Tambah Alamat ")]),_:1},8,["onClick"])])])),r(y,{modelValue:s.modalShow,"onUpdate:modelValue":t[0]||(t[0]=o=>s.modalShow=o),class:"address-list","show-close":!1},{header:l(({titleId:o})=>[a("div",re,[a("h4",{id:o,class:"fs-5 fw-bold my-auto"}," Pilih Alamat Pengiriman ",8,ie)])]),default:l(()=>[(u(!0),p(B,null,P(s.dataList,o=>(u(),p("div",{class:"block block-rounded block-bordered mb-15",key:o.id},[a("div",ne,[r(k,null,{default:l(()=>[r(f,{span:20},{default:l(()=>[a("div",de,[a("div",me,[a("span",ce,d(o.reciever),1),c("("+d(o.name)+") ",1)]),a("div",null,d(o.phone),1),a("div",he,d(o.address),1),a("div",ue,d(o.area_text),1)]),r(n,{type:"info",onClick:C=>h.edit(o),size:"small"},{default:l(()=>[_e,c(" Ubah ")]),_:2},1032,["onClick"])]),_:2},1024),r(f,{span:4,class:"d-flex"},{default:l(()=>[this.selected.id!=o.id?(u(),x(n,{key:0,type:"primary",onClick:C=>h.selectAddress(o),class:"my-auto"},{default:l(()=>[pe,c(" Pilih ")]),_:2},1032,["onClick"])):V("",!0)]),_:2},1024)]),_:2},1024)])]))),128))]),_:1},8,["modelValue"]),r(y,{modelValue:s.modalForm,"onUpdate:modelValue":t[7]||(t[7]=o=>s.modalForm=o),class:"address-form","show-close":!1},{header:l(({titleId:o})=>[a("div",fe,[a("h4",{id:o,class:"fs-5 fw-bold my-auto"},d(s.title),9,ge)])]),default:l(()=>[r(L,{"label-position":"top","label-width":"100%",onSubmit:b(h.submit,["prevent"])},{default:l(()=>[r(_,{label:"Alamat",error:s.errors.phone},{default:l(()=>[r(g,{modelValue:s.form.address,"onUpdate:modelValue":t[1]||(t[1]=o=>s.form.address=o),type:"textarea",rows:2,placeholder:"Masukan Alamat"},null,8,["modelValue"])]),_:1},8,["error"]),r(_,{label:"Nama Alamat",error:s.errors.name},{default:l(()=>[r(g,{modelValue:s.form.name,"onUpdate:modelValue":t[2]||(t[2]=o=>s.form.name=o),type:"text",placeholder:"Masukan Nama Alamat"},null,8,["modelValue"])]),_:1},8,["error"]),r(k,{gutter:20},{default:l(()=>[r(f,{span:12},{default:l(()=>[r(_,{label:"Nama Penerima",error:s.errors.name},{default:l(()=>[r(g,{modelValue:s.form.reciever,"onUpdate:modelValue":t[3]||(t[3]=o=>s.form.reciever=o),type:"text",placeholder:"Masukan Nama Penerima"},null,8,["modelValue"])]),_:1},8,["error"])]),_:1}),r(f,{span:12},{default:l(()=>[r(_,{label:"No HP Penerima",error:s.errors.phone},{default:l(()=>[r(g,{modelValue:s.form.phone,"onUpdate:modelValue":t[4]||(t[4]=o=>s.form.phone=o),type:"text",placeholder:"Masukan No Handphone"},null,8,["modelValue"])]),_:1},8,["error"])]),_:1})]),_:1}),r(_,{label:"Jadikan Alamat Utama?"},{default:l(()=>[r(A,{modelValue:s.form.is_main,"onUpdate:modelValue":t[5]||(t[5]=o=>s.form.is_main=o)},{default:l(()=>[r(w,{label:1,border:""},{default:l(()=>[c("Ya")]),_:1}),r(w,{label:0,border:""},{default:l(()=>[c("Tidak")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a("div",be,[r(n,{type:"primary",plain:"",onClick:t[6]||(t[6]=o=>s.selectMap=!0)},{default:l(()=>[c(" Kembali ")]),_:1}),r(n,{type:"primary",onClick:h.submit},{default:l(()=>[c(" Simpan ")]),_:1},8,["onClick"])])]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"])])}const Pe=S(I,[["render",ke]]);export{Pe as default};
